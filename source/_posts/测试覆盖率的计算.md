---
title: 测试覆盖率统计
date: 2021-04-17 19:56:52
tags:
---
# 概述
测试覆盖率并不是什么衡量的标准，但是拥有测试覆盖率，可以让我们知道代码哪里测试了，哪里没有测试。 再进一步深入可以完成精准测试的目的。  需要注意的是，**测试覆盖率统计最好只用在测试环境，而不能用在生产环境**。 
# 准备

1. Docker
1. Spring Example:   [https://github.com/codemak2r/sprintboot-example-for-jacoco](https://github.com/codemak2r/sprintboot-example-for-jacoco) 
# 以 SpringBoot 为例
## build
首先进入 springboot-example-for-jacoco
```shell
cd springboot-example-for-jacoco
```
然后我们需要 build 一下这个应用
![](https://cdn.nlark.com/yuque/0/2021/png/12380794/1618556844592-85bd5f2f-168a-445b-b1f3-c54123aa3b03.png#clientId=u1de0200a-582a-4&from=ui&id=WR7Pq&margin=%5Bobject%20Object%5D&originHeight=477&originWidth=524&originalType=binary&size=36218&status=done&style=none&taskId=u8372e2cf-180d-4bcc-a686-4f89a11441f)
然后我们就可以在 target 中找到这个 jar 包。
## 部署
目前大部分的部署都是云的方式，这里我们假装使用云的方式，就用 docker 来运行这个应用
```shell
docker build --no-cache springexample .
docker run -p 6300:6300 -p 8090:8090 springexample
```
## 执行测试
目前就运行起来了我们这个应用，然后我们访问接口： http://127.0.0.1:8090/api/v1/hello


## 获取覆盖率
最后通过运行 jacococli.jar 来获取覆盖率报告
```shell
java -jar jacococli.jar dump --address 192.168.103.111 --port 6300 --destfile jacoco.exec
```
## 生成报告
得到的 jacoco.exec 不能直接使用，我们可以通过 IntelliJ 的 run -> Generate Coverage Report 来生成 HTML report
![](https://cdn.nlark.com/yuque/0/2021/png/12380794/1618556623598-9e770245-b00e-4bf5-96a2-7e0a3785b21b.png#clientId=u1de0200a-582a-4&from=ui&id=FqkMB&margin=%5Bobject%20Object%5D&originHeight=233&originWidth=843&originalType=binary&size=40205&status=done&style=none&taskId=ufce6ec1b-7946-4b52-84a9-5bf3e254780)


# 总结
这里主要记录一下 demo 是如何操作的，主要的精华其实无他，就是在 Dockerfile 里面启动应用的时候加上 JAVA_OPS 
```shell
ENV JAVA_OPTS="-javaagent:jacocoagent.jar=includes=*,output=tcpserver,append=true,address=0.0.0.0,port=6300"
```
这样在启动应用的时候，我们就插入了一个桩点，当我们访问相关功能的时候，触发的相应的代码都会被记录下来，从而达到了测试覆盖率统计的功能。 
# 参考
[https://testerhome.com/topics/20632](https://testerhome.com/topics/20632) 
[http://blog.kail.xyz/post/2018-09-24/qa/jacoco-simple.html](http://blog.kail.xyz/post/2018-09-24/qa/jacoco-simple.html)
